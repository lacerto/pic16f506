# PIC16F506 Comparator Example

## Description
This example shows how to use the comparator and the comparator voltage reference modules.

## Parts list
### Test circuit
* 1x PIC16F506 microcontroller
* 2x Resistor 150&Omega;
* 2x LED (V<sub>F</sub> &cong; 2V)
* 1x potentiometer 10k&Omega;

### Power supply
I used an [LD33V (LD1117V33)](http://www.st.com/content/ccc/resource/technical/document/datasheet/99/3b/7d/91/91/51/4b/be/CD00000544.pdf/files/CD00000544.pdf/jcr:content/translations/en.CD00000544.pdf) voltage regulator and a 9V NiMH rechargable block as the circuit does not draw two much current.
* 1x LD33V 3.3V voltage regulator
* 1x electrolytic capacitor 0.1&micro;F between V<sub>in</sub> and GND
* 1x electrolytic capacitor 10&micro;F between V<sub>out</sub> and GND

## Circuit diagram
![Schematic] (https://github.com/lacerto/pic16f506/blob/comparator/Comparator.X/PIC16F506_Comparator.png)

## How it works
The program constantly blinks an "alive" LED connected to RB2. It uses comparator C2 as an internally generated voltage reference can be defined for one of the C2 comparator inputs.

The voltage reference is generated by the Comparator Voltage Reference Module which the program sets up to generate a CV<sub>REF</sub> in the low range:

CV<sub>REF</sub> = (VR<3:0>/24) x V<sub>dd</sub>  where VR<3:0> are the lower 4 bits of the VRCON SFR.

As V<sub>dd</sub> = 3.3V and VR<3:0> = 15, so 

CV<sub>REF</sub> = (15/24) x 3.3V = 2.0625V

The potentiometer's wiper is connected to the other C2 comparator input forming a voltage divider. If the voltage reaches the threshold calculated above it's output becomes high and the other LED will light up.

The delay routine also checks the comparator output bit and blinks the alive LED ca. two times faster.
